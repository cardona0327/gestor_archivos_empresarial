{% extends "index.html" %}
{% block contenido %}
<h2>B√∫squeda avanzada</h2>

<form method="post" class="mb-4">
  <div class="row g-2 align-items-end">
    <div class="col-md-3">
      <label class="form-label">Nombre (archivo o carpeta)</label>
      <input type="text" name="q_nombre" class="form-control" value="{{ filtros.nombre or '' }}">
    </div>

    <div class="col-md-3">
      <label class="form-label">Descripci√≥n (archivos)</label>
      <input type="text" name="q_descripcion" class="form-control" value="{{ filtros.descripcion or '' }}">
    </div>

    <div class="col-md-2">
      <label class="form-label">Fecha desde</label>
      <input type="date" name="q_fecha_desde" class="form-control" value="{{ filtros.fecha_desde or '' }}">
    </div>

    <div class="col-md-2">
      <label class="form-label">Fecha hasta</label>
      <input type="date" name="q_fecha_hasta" class="form-control" value="{{ filtros.fecha_hasta or '' }}">
    </div>

    <div class="col-md-2">
      <label class="form-label">Filtros</label>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="filtrar_archivos" name="filtrar_archivos" {% if filtros.buscar_en_archivos %}checked{% endif %}>
        <label class="form-check-label" for="filtrar_archivos">Archivos</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="filtrar_carpetas" name="filtrar_carpetas" {% if filtros.buscar_en_carpetas %}checked{% endif %}>
        <label class="form-check-label" for="filtrar_carpetas">Carpetas</label>
      </div>
    </div>

  </div>

  <div class="mt-3">
    <button type="submit" class="btn btn-primary">Buscar</button>
    <a href="{{ url_for('buscar') }}" class="btn btn-secondary">Limpiar</a>
  </div>
</form>

<hr>

{% if resultados_carpetas %}
<h4>Carpetas encontradas</h4>
<ul class="list-group mb-3">
  {% for carpeta in resultados_carpetas %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        üìÅ <strong>{{ carpeta['nombre_carpeta'] }}</strong>
        <div class="text-muted small">Creaci√≥n: {{ carpeta['fecha_creacion'] }}</div>
      </div>
      <div class="btn-group">
        <a href="{{ url_for('ver_categoria', categoria_id=carpeta['id_categoria']) }}?carpeta_id={{ carpeta['id'] }}" class="btn btn-sm btn-outline-primary">Abrir</a>
        <a href="{{ url_for('descargar_carpeta', categoria_id=carpeta['id_categoria']) }}?carpeta_id={{ carpeta['id'] }}" class="btn btn-sm btn-outline-secondary">Descargar</a>
      </div>
    </li>
  {% endfor %}
</ul>
{% endif %}

{% if resultados_archivos %}
<h4>Archivos encontrados</h4>
<ul class="list-group mb-3">
  {% for archivo in resultados_archivos %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        üìÑ <strong>{{ archivo['nombre_original'] }}</strong>
        <div class="small text-muted">{{ archivo['descripcion'] or 'Sin descripci√≥n' }}</div>
        <div class="text-muted small">Subido: {{ archivo['fecha_subida'] }}</div>
      </div>
      <div class="btn-group">
        <a href="{{ url_for('descargar_archivo', archivo_id=archivo['id']) }}" class="btn btn-sm btn-outline-primary">Descargar</a>
        <a href="{{ url_for('editar_archivo', archivo_id=archivo['id']) }}" class="btn btn-sm btn-outline-warning">Editar</a>
      </div>
    </li>
  {% endfor %}
</ul>
{% endif %}

{% if not resultados_archivos and not resultados_carpetas and filtros %}
  <div class="alert alert-info">No se encontraron resultados para los filtros seleccionados.</div>
{% endif %}

{% endblock %}
